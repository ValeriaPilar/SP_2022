---
title: "Campaña contra Sarampion y Polio 2022"
output: 
  flexdashboard::flex_dashboard:
    orientation: row
    theme: 
      version: 4
      bg: "#FFFFFF"
      fg: "#101010" 
      bootswatch: minty
      navbar-bg: "#8EB5AE"

---

```{r setup, include=FALSE}
library(readxl)
library(dplyr)
library(flexdashboard)
library(ggplot2)
library(patchwork)
library(kableExtra)
library(scales)

```

Triple Viral {data-icon="fa-signal"}
===================================== 

Inputs {.sidebar data-width=250}
--------------------------------------------------

```{r set, include=FALSE}
reporte_Triple_Viral <- read_excel("reporte_Triple_Viral.xlsx")
reporte_dosis_dia_Triple_Viral <- aggregate(reporte_Triple_Viral$dosis_registradas,
                                   by=list(Category= reporte_Triple_Viral$fecha_administracion), FUN=sum)
names(reporte_dosis_dia_Triple_Viral) [1] <- "fecha"
names(reporte_dosis_dia_Triple_Viral) [2] <- "registradas"

#computeAplicadas = function(...) return(nrow(reporte_Triple_Viral))
computeAplicadasTV = function(...) return(nrow(reporte_Triple_Viral))
reporte_TV_aplicacion_edad <- read_excel("reporte_TV_aplicacion_edad.xlsx")
computeTV_apli_1 = function(...) return(reporte_TV_aplicacion_edad$aplicadas[1])
computeTV_apli_2 = function(...) return(reporte_TV_aplicacion_edad$aplicadas[2])
computeTV_apli_3 = function(...) return(reporte_TV_aplicacion_edad$aplicadas[3])
computeTV_apli_4 = function(...) return(reporte_TV_aplicacion_edad$aplicadas[4])


#Domicilio
reporte_Triple_Viral_resi <- aggregate(reporte_Triple_Viral$dosis_registradas,
                                   by=list(Category=reporte_Triple_Viral$residente_caba), FUN=sum)
names(reporte_Triple_Viral_resi) [1] <- "residente_caba"
names(reporte_Triple_Viral_resi) [2] <- "dosis_registradas"

computeTV_no = function(...) return(reporte_Triple_Viral_resi$dosis_registradas[1])
computeTV_si = function(...) return(reporte_Triple_Viral_resi$dosis_registradas[2])
computeTV_SD = function(...) return(reporte_Triple_Viral_resi$dosis_registradas[3])

```

### **Total de dosis registradas por fecha** {data-width=200}

```{r echo=FALSE}
knitr::kable(reporte_dosis_dia_Triple_Viral, format="html") %>%
  kable_styling(font_size = 13)

```

Column {data-height=150}
-----------------------------------------------------------------------

### **Aplicaciones Registradas Totales** 

```{r}
AplicadasTV = computeAplicadasTV()
valueBox(AplicadasTV, icon = "fa-syringe",
  color = "#85D4E3")
```

### **Registradas residentes CABA** 

```{r}
TV_apli_si = computeTV_si()
valueBox(TV_apli_si, icon = "fa-map-marker-alt",
  color = "#F5D54F")
```


### **Registradas no residentes** 

```{r}
TV_apli_no = computeTV_no()
valueBox(TV_apli_no, icon = "fa-map-marker-alt",
  color = "light")
```

### 

```{r}
ComputePERresi = function(...) return((TV_apli_si *100) / (TV_apli_si + TV_apli_no))
PERresi = ComputePERresi()
gauge(round(PERresi, digits = 0), min = 0, max = 100, symbol = '%', gaugeSectors(
  danger = c(0, 50), success = c(50, 79), warning = c(80, 100), colors = c("#619AB3", "#F5D54F", "#A2D3EA")
))
```

Column {data-height=150}
-----------------------------------------------------------------------

### **Registradas 1 año** 

```{r}
TV_apli_1 = computeTV_apli_1()
valueBox(TV_apli_1, icon = "fa-child",
  color = "#A7D5CD")
```

### **Registradas 2 años** 

```{r}
TV_apli_2 = computeTV_apli_2()
valueBox(TV_apli_2, icon = "fa-child",
  color = "#A7D5CD")

```

### **Registradas 3 años** 

```{r}
TV_apli_3 = computeTV_apli_3()
valueBox(TV_apli_3, icon = "fa-child",
  color = "#A7D5CD")
```

### **Registradas 4 años** 

```{r}

TV_apli_4 = computeTV_apli_4()
valueBox(TV_apli_4, icon = "fa-child",
  color = "#A7D5CD")

```

Column {data-width=650}
-----------------------------------------------------------------------

### **Dosis por día**
    
```{r }
ggplot(reporte_Triple_Viral, aes(fecha_administracion, fill = tipo_efector)) +
    geom_bar() +
    scale_fill_manual(values=c("#A7D5CD", "#85D4E3", "#6DC0E5", "#619AB3", "#F5D54F", "#A2D3EA")) +
    theme_linedraw() +
    scale_y_continuous(breaks= seq(from = 0, to = 100000, by = 500)) +
    labs(x = "Fecha", y = "Dosis Registradas", title ="Dosis registradas por día")
    
```

Polio {data-icon="fa-signal"}
===================================== 


Inputs {.sidebar data-width=250}
--------------------------------------------------

```{r , include=FALSE}
reporte_Polio <- read_excel("reporte_Polio.xlsx")
reporte_dosis_dia_Polio <- aggregate(reporte_Polio$dosis_registradas,
                                   by=list(Category= reporte_Polio$fecha_administracion), FUN=sum)
names(reporte_dosis_dia_Polio) [1] <- "fecha"
names(reporte_dosis_dia_Polio) [2] <- "registradas"

computeAplicadasPOLIO = function(...) return(nrow(reporte_Polio))
reporte_P_aplicacion_edad <- read_excel("reporte_P_aplicacion_edad.xlsx")
computeP_apli_1 = function(...) return(reporte_P_aplicacion_edad$aplicadas[1])
computeP_apli_2 = function(...) return(reporte_P_aplicacion_edad$aplicadas[2])
computeP_apli_3 = function(...) return(reporte_P_aplicacion_edad$aplicadas[3])
computeP_apli_4 = function(...) return(reporte_P_aplicacion_edad$aplicadas[4])


#Domicilio
reporte_Polio_resi <- aggregate(reporte_Polio$dosis_registradas,
                                   by=list(Category=reporte_Polio$residente_caba), FUN=sum)
names(reporte_Polio_resi) [1] <- "residente_caba"
names(reporte_Polio_resi) [2] <- "dosis_registradas"

```

### **Total de dosis registradas por fecha** {data-width=200}

```{r echo=FALSE}
knitr::kable(reporte_dosis_dia_Polio, format="html") %>%
  kable_styling(font_size = 13)

```

Column {data-height=150}
-----------------------------------------------------------------------

### **Aplicaciones Registradas Totales** 

```{r}
computeAplicadasP = function(...) return(nrow(reporte_Polio))
AplicadasP = computeAplicadasP()
valueBox(AplicadasP, icon = "fa-syringe",
  color = "#85D4E3")
```

### **Registradas residentes CABA** 

```{r}

computeP_si = function(...) return(reporte_Polio_resi$dosis_registradas[2])
P_apli_si = computeP_si()
valueBox(P_apli_si, icon = "fa-map-marker-alt",
  color = "#F5D54F")
```


### **Registradas no residentes** 

```{r}
computeP_no = function(...) return(reporte_Polio_resi$dosis_registradas[1])
P_apli_no = computeP_no()
valueBox(P_apli_no, icon = "fa-map-marker-alt",
  color = "light")
```

### 

```{r}
ComputePERresiPolio = function(...) return((P_apli_si *100) / (P_apli_si + P_apli_no))
PERresiPolio = ComputePERresiPolio()
gauge(round(PERresiPolio, digits = 0), min = 0, max = 100, symbol = '%', gaugeSectors(
  danger = c(0, 50), success = c(50, 79), warning = c(80, 100), colors = c("#619AB3", "#F5D54F", "#A2D3EA")
))
```

Column {data-height=150}
-----------------------------------------------------------------------

### **Registradas 1 año** 

```{r}
P_apli_1 = computeP_apli_1()
valueBox(P_apli_1, icon = "fa-child",
  color = "#A7D5CD")
```

### **Registradas 2 años** 

```{r}
P_apli_2 = computeP_apli_2()
valueBox(P_apli_2, icon = "fa-child",
  color = "#A7D5CD")

```

### **Registradas 3 años** 

```{r}
P_apli_3 = computeP_apli_3()
valueBox(P_apli_3, icon = "fa-child",
  color = "#A7D5CD")
```

### **Registradas 4 años** 

```{r}

P_apli_4 = computeP_apli_4()
valueBox(P_apli_4, icon = "fa-child",
  color = "#A7D5CD")

```

Column {data-width=650}
-----------------------------------------------------------------------

### **Dosis por día**
    
```{r }

ggplot(reporte_Polio, aes(fecha_administracion, fill = tipo_efector)) +
    geom_bar() +
    scale_fill_manual(values=c("#A7D5CD", "#85D4E3", "#6DC0E5", "#619AB3", "#F5D54F", "#A2D3EA")) +
    theme_linedraw() +
    scale_y_continuous(breaks= seq(from = 0, to = 100000, by = 500)) +
    labs(x = "Fecha", y = "Dosis Registradas", title ="Dosis registradas por día")
    
```

Efector {data-icon="fa-hospital" data-orientation=columns}
===================================== 

Inputs
--------------------------------------------------

### **Total de dosis registradas por efector - Triple Viral**

```{r echo=FALSE}

reporte_TV_efectores <- aggregate(reporte_Triple_Viral$dosis_registradas,
                                   by=list(Category= reporte_Triple_Viral$efector), FUN=sum)
names(reporte_TV_efectores) [1] <- "efector"
names(reporte_TV_efectores) [2] <- "registradas"

library(DT)
datatable(reporte_TV_efectores,  class = 'cell-border', rownames = head(NULL), colnames = c('Efector', 'Registros Triple Viral'), options = list(
  order = list(1, 'desc'),
  columnDefs = list(list()),
  pageLength = 100,
  lengthMenu = c(20, 50, 100)
))
```

Inputs
--------------------------------------------------

### **Total de dosis registradas por efector - Vacuna Salk (IPV)**

```{r echo=FALSE}
reporte_P_efectores <- aggregate(reporte_Polio$dosis_registradas,
                                   by=list(Category= reporte_Polio$efector), FUN=sum)
names(reporte_P_efectores) [1] <- "efector"
names(reporte_P_efectores) [2] <- "registradas"

datatable(reporte_P_efectores,  class = 'cell-border', rownames = head(NULL), colnames = c('Efector', 'Registros Salk'), options = list(
  order = list(1, 'desc'),
  columnDefs = list(list()),
  pageLength = 100,
  lengthMenu = c(20, 50, 100)
))

```

Personas vacunadas {data-icon="fa-table" data-orientation=rows}
===================================== 

Inputs
--------------------------------------------------

### **Personas vacunadas** {data-width=50}

```{r echo=FALSE}

### HACER READ EXCEL PARA PERS_VACUNADS

personas_vacunadas <- read_excel("personas_vacunadas.xlsx")

datatable(personas_vacunadas,  class = 'cell-border', rownames = head(NULL), colnames = c('Fecha', 'Efector', "Edad", "Residente CABA", "Personas vacunadas"),
          options = list(
  order = list(4, 'desc'), 
  columnDefs = list(list()),
  pageLength = 100,
  lengthMenu = c(20, 50, 100)
))

```

No administradas {data-icon="fa-syringe" data-orientation=rows}
===================================== 

Inputs
--------------------------------------------------

### **Registro de vacunas no administradas**

```{r echo=FALSE}
no_adm <- read_excel("no_adm.xlsx")
datatable(no_adm,  class = 'cell-border', rownames = head(NULL),colnames = c("Fecha", "Edad", "Residente CABA", "Justificación", "Vacuna", "Efector"), 
          options = list(
  order = list(4, 'desc'), 
  columnDefs = list(list()),
  pageLength = 100,
  lengthMenu = c(20, 50, 100))
)
```